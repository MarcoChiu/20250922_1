<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>題目五：心理測驗</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="../css/style.css" rel="stylesheet">
    <style>
        main {
            background: teal;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .panel {
            width: 400px;
            background-color: white;
            padding: 1rem;
            margin: 1rem;
        }

        .test {
            width: 400px;
            background-color: white;
            padding: 1rem;
            margin: 1rem;
        }

        .result {
            width: 400px;
            background-color: white;
            padding: 1rem;
            margin: 1rem;
        }

        .display-none {
            display: none;
        }

        .display-block {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>題目五：心理測驗</h2>
        <p>請達成以下功能：</p>
        <ul>
            <li>(開始測驗) > 進入測驗，隱藏介紹卡片，從資料中生成問題與選項</li>
            <li>(生成問題) > 顯示目前問題長度與目前位置</li>
            <li>(點擊選項或單選框) > 進入下個步驟並記錄此筆資料(種類、分數)</li>
            <li>(提交完最後一個問題) > 顯示詢問姓名問題</li>
            <li>(提交完姓名) > 呈現出問題蒐集出來的資料/li>
        </ul>
        <p>✨keywords：eval()</p>
        <main>
            <!-- Intro -->
            <div class="panel">
                <h1>網頁性格測驗</h1>
                <p>製作網頁是一個多種領域發揮的舞台，助教製作了一款簡易的網頁性格測驗，來測試看看同學們對網頁不同領域的喜好程度～</p>
                <button class="start">開始測驗～</button>
            </div>

            <!-- Test -->
            <div class="test display-none"></div>

            <!-- Result -->
            <div class="result display-none"></div>
        </main>
    </div>
    <script>
        //這邊的資料建立使用比較簡單的呈現方式
        const data = [
            {
                question: "title01-1？",
                type: "type01",
                choices: [
                    {
                        title: "+1000",
                        value: "+1000"
                    },
                    {
                        title: "-1000",
                        value: "-1000"
                    }
                ]
            },
            {
                question: "title1-2？",
                type: "type01",
                choices: [
                    {
                        title: "/2",
                        value: "/2"
                    },
                    {
                        title: "*50",
                        value: "*50"
                    }
                ]
            },
            {
                question: "title02？",
                type: "type02",
                choices: [
                    {
                        title: "+150",
                        value: "+150"
                    },
                    {
                        title: "-150",
                        value: "-150"
                    }
                ]
            },
            {
                question: "title03?",
                type: "type03",
                choices: [
                    {
                        title: "+20",
                        value: "+20"
                    },
                    {
                        title: "-5",
                        value: "-5"
                    }
                ]
            },
            {
                question: "title04？",
                type: "type04",
                choices: [
                    {
                        title: "+1000",
                        value: "+1000"
                    },
                    {
                        title: "-50",
                        value: "-50"
                    }
                ]
            }
        ];

        const start = document.querySelector(".start");
        const panel = document.querySelector(".panel");
        const result = document.querySelector(".result");
        const test = document.querySelector(".test");

        //與前幾題相同的索引概念
        let now = 0;

        //建立一個存放分數的空間，但後面才會使用到
        let totalScore = {};

        //tip 宣告變數可以都放在同一個地方，這樣可視性會較佳

        start.addEventListener("click", () => {
            panel.classList.add("display-none");
            testRender();
        });

        function testRender() {
            test.classList.remove("display-none");

            //當頁面數在最後一頁時，就能渲染出結果
            if (data.length == now) {
                test.classList.add("display-none");
                resultRender();
                return;
            };

            //這邊將資料歸零
            if (!totalScore[data[now].type]) {
                totalScore[data[now].type] = 0;
            }

            let testContent = `
  <h2>
    ${data[now].question}
  </h2>
  <ul>
    <label><input type="radio" name="${data[now].type}" data-score="${data[now].choices[0].value}">${data[now].choices[0].title}</label>
  <label><input type="radio" name="${data[now].type}" data-score="${data[now].choices[1].value}">${data[now].choices[1].title}</label>
  </ul>
  `;
            test.innerHTML = testContent;

            //因為 HTML 的內容是動態產生，所以會在這邊加入選擇器便能選擇到該項目，當然也可以使用其他方式將此區塊拉到外面獨立建立
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach((i) => {

                //當 checkbox 有變動時執行動作
                i.addEventListener("change", () => {

                    //若以下的內容純為 +- ，可將數字化為整數(使用 parseInt())，因為資料內容為 string ，接著將內容個別加入資料就能依據正負值做加減，可以先嘗試看看單純的加減

                    const selectedValue = i.getAttribute("data-score");

                    //以下的範例是有包含乘除

                    //內容的部分是字串，這邊先將計算式以字串形式儲存下來
                    let stringValue = "";
                    stringValue += selectedValue;

                    //乘除到這邊      

                    //這邊直接建立一個屬性與加入後面的值，使用賦值運算子的方式運作
                    totalScore[data[now].type] += stringValue;

                    //增加索引參考
                    now++;

                    //換下一頁渲染題目(若為最後一頁會在前方判斷式渲染結果頁並在當行停止)
                    testRender();
                });
            });
        };

        function resultRender() {

            //乘除須加上這裡的迴圈計算字串

            //這裡使用迴圈的方式，取得個別內容的字串
            for (const key in totalScore) {
                const result = totalScore[key];

                //最後字串使用 eval 的方式，執行 string 內容的程式碼，再個別賦值
                totalScore[key] = eval(result);
            };

            result.classList.remove("display-none");

            let enter = `
  <label for="id">請輸入使用者名稱</label>
    <input type="text" name="id" placeholder="請輸入使用者名稱">
    <button class="submit" type="submit">提交</button>
  `;

            result.innerHTML = enter;

            const submit = document.querySelector(".submit");
            const enterName = document.querySelector('input[name="id"]');

            submit.addEventListener("click", (e) => {

                //因為我這裡的 button 的 type="submit" ，所以會使用取消預設動作的方式
                e.preventDefault();

                //將輸入的資料建立一個變數存放
                let name = enterName.value;

                let finish = `
    <h2>
      ${name}的測驗結果為:
    </h2>
    <p>
      ${JSON.stringify(totalScore)}
    </p>
    <button type="button" class="renew">再測一次</button>
    `
                //內容會使用 JSON.stringify(totalScore) 的原因是單純 totalScore 是物件，若直接呈現會出現異常(可以嘗試去除 JSON.stringify 看看)，所以將物件轉為 JSON 呈現

                result.innerHTML = finish;

                const renew = document.querySelector(".renew");

                //當點擊時將資料全部歸零後重第一題開始
                renew.addEventListener("click", renewTest)
            })
        };

        function renewTest() {

            //關閉結果畫面
            result.classList.add("display-none");

            //將索引與計分內容歸零
            now = 0;
            totalScore = {};

            //渲染題目，因為索引已歸零，所以會從第一題開始
            testRender();
        };
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
        integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
        crossorigin="anonymous"></script>
    <script src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js'></script>
    <script src="../js/nav.js"></script>
</body>

</html>