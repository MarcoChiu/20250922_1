<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>題目四：步驟表單</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link href="../css/style.css" rel="stylesheet">
  <style>
    main {
      background: teal;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .step {
      background-color: white;
      color: black;
      display: flex;
      flex-direction: column;
      width: 300px;
      padding: 16px;

      label {
        display: flex;
        flex-direction: column;
      }

      .btn {
        margin-top: 16px;
        display: flex;
        gap: 1rem;
        justify-content: center;
      }
    }

    .display-none {
      display: none;
    }

    .invalid {
      border: 1px solid red;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>題目四：步驟表單</h2>
    <p>請達成以下功能：</p>
    <ul>
      <li>(點擊上一步) > 回到上個步驟</li>
      <li>(點擊下一步) > 驗證後到下個步驟，如是最終步驟，console.log 表單資料</li>
      <li>(驗證) > 當點擊下一步時驗證當前步驟中的輸入內容是否都和規，如不合規，對焦於不和規的輸入上，並且更改其樣式屬性提醒用戶。</li>
    </ul>
    <p>✨keywords：element.focus(), element.style, form.elements, input.checkValidity()</p>

    <main>
      <h1>步驟表單</h1>
      <form>
        <!-- 01 -->
        <div class="step">
          <h2>步驟一</h2>
          <hr>
          <label>
            電子信箱
            <input name="email" type="email" placeholder="請輸入電子信箱" class="input" required>
          </label>
          <label>
            密碼
            <input name="password" type="password" placeholder="請輸入密碼" class="input" required>
          </label>
          <div class="btn">
            <button type="button" data-next>下一步</button>
          </div>
        </div>

        <!-- 02 -->
        <div class="step">
          <h2>步驟二</h2>
          <hr>
          <label>
            地址
            <input name="adress" type="text" placeholder="請輸入您的地址" class="input" required>
          </label>
          <label>
            城市
            <input name="city" type="text" placeholder="請輸入您的城市" class="input" required>
          </label>
          <div class="btn">
            <button type="button" data-prev>上一步</button>
            <button type="button" data-next>下一步</button>
          </div>
        </div>

        <!-- 03 -->
        <div class="step">
          <h2>步驟三</h2>
          <hr>
          <label>
            名稱
            <input name="name" type="text" placeholder="請輸入您的名稱" class="input" required>
          </label>
          <label>
            電話
            <input name="phone" type="phone" placeholder="請輸入您的電話" class="input" required>
          </label>
          <div class="btn">
            <button type="button" data-prev>上一步</button>
            <button type="button" data-submit>下一步</button>
          </div>

        </div>
      </form>
    </main>


  </div>
  <script>
    //雖題目為三個區塊做填寫，但以這邊的實作方法，會將該表格做為一個表格，透過分區與 display 的方式去開啟關閉

    const step = document.querySelectorAll(".step");
    const btn = document.querySelectorAll(".btn");

    //與前一題相同，需要有一個參考的程式碼索引位置
    let page = 0;

    //建立一個資料的收集變數
    let collectedData = {};

    function PageRender() {
      step.forEach((i, index) => {

        //這裡與上周的觀念相同，先將所有的內容關閉後再選擇其中一個打開
        i.classList.add("display-none");

        //選擇到符合的 page 後移除 display-none
        if (index == page) {
          i.classList.remove("display-none");
        }
      });
    }

    //因為是使用 querySelectorAll 的方式，所以使用迴圈的方式確認點擊的位置
    btn.forEach((i) => {
      i.addEventListener("click", (e) => {

        //這邊透過 hasAttribute 的方式，尋找按鈕內的屬性
        if (e.target.hasAttribute("data-next")) {

          //這邊為驗證的區塊，若驗證通過則 page++ 並渲染下一頁的資料(函式內容在下方，若不符合驗證會取得 false 的結果)
          if (validity()) {
            page++;
            PageRender();
          }
        } else if (e.target.hasAttribute("data-prev")) {
          page--;
          PageRender();
        } else if (e.target.hasAttribute("data-submit") && validity()) {

          //當最後結束時，將資料統整(函式內容在下方)
          collectData();
          page++;
          PageRender();
        }
      });
    });

    function validity() {
      let isValid = true;

      //搜尋資料內的內容
      step[page].querySelectorAll(".input").forEach((i) => {

        //.checkValidity() 為原生的語法，會做初步的驗證，若目前的每一項都符合則為 true
        if (i.checkValidity()) {
          i.classList.remove("invalid");
        } else {

          //否則會執行 .reportValidity() ，這裡也為原生語法，會挑出警示
          i.reportValidity();

          //在不符合的部分也增加提示
          i.classList.add("invalid");

          //最後將 isValid 設置為 false
          isValid = false;
        }
      });

      //回傳 isValid 的值
      return isValid;
    }

    //最後的函式就是收集資料的部分
    function collectData() {
      step.forEach((i, index) => {
        const inputs = i.querySelectorAll(".input");
        inputs.forEach((input) => {

          //這邊是取讀取性質，抓 name 的部分
          const key = input.getAttribute("name");

          //抓 input.value 的資料
          const value = input.value;

          //接著將資料建立起來，key 為屬性 value 為值(要注意這邊是上方建立的 collectedData ，不是當前函式的 collectData)
          collectedData[key] = value;
        });
      });

      //這邊是完成的資料
      console.log(collectedData);
    }

    PageRender();

  </script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
    integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
    crossorigin="anonymous"></script>
  <script src='https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js'></script>
  <script src="../js/nav.js"></script>
</body>

</html>